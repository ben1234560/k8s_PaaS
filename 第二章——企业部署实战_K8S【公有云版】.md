## ç¬¬äºŒç« â€”â€”ä¼ä¸šéƒ¨ç½²å®æˆ˜_K8Sã€å…¬æœ‰äº‘ç‰ˆã€‘

### å‰è¨€ï¼ˆæ¨èä½¿ç”¨éå…¬æœ‰äº‘ç‰ˆï¼Œå› ä¸ºå¤šæ¬¡é€‚é…è¿‡åç»­å†…å®¹ï¼‰ï¼š

æ³¨ï¼šå…¬æœ‰äº‘ç‰ˆæœªæµ‹è¯•æ˜¯å¦é€‚é…ç¬¬ä¸‰ç« å¾€åå†…å®¹ï¼Œç†è®ºä¸Šæ˜¯å®Œå…¨å¯è¡Œçš„ã€‚

**è€ƒè™‘åˆ°éƒ¨åˆ†åŒå­¦æœºå™¨é…ç½®å¹¶æ— æ³•æ»¡è¶³å¤šå¼€VMwareï¼Œè¿™é‡Œæ¨å‡ºå…¬æœ‰äº‘ç‰ˆæœ¬ï¼ˆä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼‰ã€‚å¿…é¡»æœ‰æ¢¯å­ï¼ˆvpn/ç¿»å¢™ï¼‰**

> **WHYï¼š**ä¸ºä»€ä¹ˆè¦æœ‰æ¢¯å­ï¼Œåé¢æˆ‘ä»¬ä¼šåˆ›å»ºä¸€äº›ç½‘ç«™ï¼Œè€Œå›½å†…åŸŸäº‘æœåŠ¡å™¨åˆ›å»ºçš„ç½‘ç«™éœ€è¦ICPå¤‡æ¡ˆï¼Œæ¯æ¬¡å¤‡æ¡ˆéƒ½éœ€è¦ç­‰å®¡æ‰¹éå¸¸éº»çƒ¦ã€‚è€Œå›½å¤–åŸŸäº‘æœåŠ¡å™¨åˆ›å»ºçš„ç½‘ç«™åˆ™ä¸éœ€è¦å¤‡æ¡ˆï¼Œç”¨èµ·æ¥éå¸¸èˆ’æœã€‚
>
> <img src="assets/WX20230511-145214@2x.png" alt="image-ICPFiling" style="zoom:25%;" />
>
> **HOWï¼š**æ¢¯å­æ¨èlestvpn(éå¹¿å‘Šï¼Œè¿™ä¸ªä¸€ä¸ªæœˆè¦40å¤šrmbï¼Œèƒ½é€‰ä»£ç†åœ°å€æˆ‘å› ä¸ºä¹Ÿç”¨chatGPTæ‰€ä»¥å¼€äº†ï¼Œæœ‰æ›´ä¾¿å®œçš„ä¸€å®šè¦æ¨èæˆ‘ğŸ˜­ï¼Œmac/windowéƒ½æµ‹è¿‡å¯ä»¥ç”¨)
>
> ä¸‹è½½é“¾æ¥ï¼ˆæ¨èä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼‰ï¼šhttps://bitbucket.org/letsgogo/letsgogo_19/src/master/README.md 
>
> å¤‡ç”¨é“¾æ¥ï¼ˆæ¨èä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼‰ï¼šhttps://github.com/LetsGo666/LetsGo_4
>
> å®‰è£…åæ‰“å¼€å¡«å†™æˆ‘çš„IDï¼š118149732 ä½ è¿˜èƒ½å¤šå¾—3å¤©ä¼šå‘˜ï¼ï¼ˆå¯ä»¥è·Ÿæœ‹å‹äº’ç›¸æ¨èäº’ç›¸å¾—å…è´¹å¤©æ•°ï¼‰



##### å¦‚æœä½ æ˜¯æ–°æ‰‹ï¼Œæœºå™¨çš„åå­—åŠå„ç§è´¦æˆ·å¯†ç ä¸€å®šè¦å’Œæˆ‘çš„ä¸€æ ·ï¼Œå…ˆå­¦ä¸€éï¼Œå†è‡ªå·±æ”¹

> **WHAT**ï¼šç”¨äºç®¡ç†äº‘å¹³å°ä¸­å¤šä¸ªä¸»æœºä¸Šçš„å®¹å™¨åŒ–çš„åº”ç”¨ï¼ŒKubernetesçš„ç›®æ ‡æ˜¯è®©éƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ç®€å•å¹¶ä¸”é«˜æ•ˆï¼ˆpowerfulï¼‰,Kubernetesæä¾›äº†åº”ç”¨éƒ¨ç½²ï¼Œè§„åˆ’ï¼Œæ›´æ–°ï¼Œç»´æŠ¤çš„ä¸€ç§æœºåˆ¶
>
> **WHY**ï¼šä¸ºä»€ä¹ˆä½¿ç”¨å®ƒï¼Œå› ä¸ºå®ƒæ˜¯ç®¡ç†dockerå®¹å™¨æœ€ä¸»æµçš„ç¼–æ’å·¥å…·

- Pod
  - Podæ˜¯K8Sé‡Œèƒ½å¤Ÿè¢«è¿è¡Œçš„æœ€å°çš„é€»è¾‘å•å…ƒï¼ˆåŸå­å•å…ƒï¼‰
  - 1ä¸ªPodé‡Œé¢å¯ä»¥è¿è¡Œå¤šä¸ªå®¹å™¨ï¼Œå®ƒä»¬å…±äº«UTS+NET+IPCåç§°ç©ºé—´
  - å¯ä»¥æŠŠPodç†è§£æˆè±Œè±†èšï¼Œè€ŒåŒä¸€Podå†…çš„æ¯ä¸ªå®¹å™¨æ˜¯ä¸€é¢—é¢—è±Œè±†
  - ä¸€ä¸ªPodé‡Œè¿è¡Œå¤šä¸ªå®¹å™¨ï¼Œåˆå«è¾¹è½¦ï¼ˆSideCarï¼‰æ¨¡å¼
- Podæ§åˆ¶å™¨ï¼ˆå…³äºæ›´å¤š<a href="https://github.com/ben1234560/k8s_PaaS/blob/master/%E5%8E%9F%E7%90%86%E5%8F%8A%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/Kubernetes%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.md#%E5%88%9D%E8%AF%86pod">åˆè¯†Pod</a>ï¼‰
  - Podæ§åˆ¶å™¨æ˜¯Podå¯åŠ¨çš„ä¸€ç§æ¨¡æ¿ï¼Œç”¨æ¥ä¿è¯åœ¨K8Sé‡Œå¯åŠ¨çš„Podå§‹ç»ˆæŒ‰ç…§äººä»¬çš„é¢„æœŸè¿è¡Œï¼ˆå‰¯æœ¬æ•°ã€ç”Ÿå‘½å‘¨æœŸã€å¥åº·çŠ¶æ€æ£€æŸ¥...ï¼‰
  - Podå†…æä¾›äº†ä¼—å¤šçš„Podæ§åˆ¶å™¨ï¼Œå¸¸ç”¨çš„æœ‰ä»¥ä¸‹å‡ ç§ï¼š
    - Deployment
    - DaemonSet
    - ReplicaSet
    - StatefulSet
    - Job
    - Cronjob
- Name
  - ç”±äºK8Så†…éƒ¨ï¼Œä½¿ç”¨â€œèµ„æºâ€æ¥å®šä¹‰æ¯ä¸€ç§é€»è¾‘æ¦‚å¿µï¼ˆåŠŸèƒ½ï¼‰ï¼Œæ•…æ¯ç§â€œèµ„æºâ€ï¼Œéƒ½åº”è¯¥æœ‰è‡ªå·±çš„â€œåç§°â€
  - â€œèµ„æºâ€æœ‰apiç‰ˆæœ¬ï¼ˆapiVersionï¼‰ç±»åˆ«ï¼ˆkindï¼‰ã€å…ƒæ•°æ®ï¼ˆmetadataï¼‰ã€å®šä¹‰æ¸…å•ï¼ˆspecï¼‰ã€çŠ¶æ€ï¼ˆstatusï¼‰ç­‰é…ç½®ä¿¡æ¯
  - â€œåç§°â€é€šå¸¸å®šä¹‰åœ¨â€œèµ„æºâ€çš„â€œå…ƒæ•°æ®â€ä¿¡æ¯é‡Œ
- <a href="https://github.com/ben1234560/k8s_PaaS/blob/master/%E5%8E%9F%E7%90%86%E5%8F%8A%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/Docker%E5%9F%BA%E7%A1%80.md#%E5%85%B3%E4%BA%8Enamespace">namespace</a>
  - éšç€é¡¹ç›®å¢å¤šã€äººå‘˜å¢åŠ ã€é›†ç¾¤è§„æ¨¡çš„æ‰©å¤§ï¼Œéœ€è¦ä¸€ç§èƒ½å¤Ÿéš”ç¦»K8Så†…å„ç§â€œèµ„æºâ€çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯åç§°ç©ºé—´
  - åç§°ç©ºé—´å¯ä»¥ç†è§£ä¸ºK8Så†…éƒ¨çš„è™šæ‹Ÿé›†ç¾¤ç»„
  - ä¸åŒåç§°ç©ºé—´å†…çš„â€œèµ„æºâ€åç§°å¯ä»¥ç›¸åŒï¼Œç›¸åŒåç§°ç©ºé—´å†…çš„åŒç§â€œèµ„æºâ€ã€â€œåç§°â€ä¸èƒ½ç›¸åŒ
  - åˆç†çš„ä½¿ç”¨K8Såç§°ç©ºé—´ï¼Œä½¿å¾—é›†ç¾¤ç®¡ç†å‘˜èƒ½å¤Ÿæ›´å¥½çš„å¯¹äº¤ä»˜åˆ°K8Sé‡Œçš„æœåŠ¡è¿›è¡Œåˆ†ç±»ç®¡ç†å’Œæµè§ˆ
  - K8Så†…é»˜è®¤å­˜åœ¨çš„åç§°ç©ºé—´æœ‰ï¼šdefaultã€kube-systemã€kube-public
  - æŸ¥è¯¢K8Sé‡Œç‰¹å®šâ€œèµ„æºâ€è¦å¸¦ä¸Šç›¸åº”çš„åç§°ç©ºé—´
- Label
  - æ ‡ç­¾æ˜¯K8Sç‰¹è‰²çš„ç®¡ç†æ–¹å¼ï¼Œä¾¿äºåˆ†ç±»ç®¡ç†èµ„æºå¯¹è±¡
  - ä¸€ä¸ªæ ‡ç­¾å¯ä»¥å¯¹åº”å¤šä¸ªèµ„æºï¼Œä¸€ä¸ªèµ„æºä¹Ÿå¯ä»¥æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œå®ƒä»¬æ˜¯å¤šå¯¹å¤šçš„å…³ç³»
  - ä¸€ä¸ªèµ„æºæ‹¥æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œå¯ä»¥å®ç°ä¸åŒç»´åº¦çš„ç®¡ç†
  - æ ‡ç­¾çš„ç»„æˆï¼škey=value
  - ä¸æ ‡ç­¾ç±»ä¼¼çš„ï¼Œè¿˜æœ‰ä¸€ç§â€œæ³¨è§£â€ï¼ˆannotationsï¼‰
- Labelé€‰æ‹©å™¨
  - ç»™èµ„æºæ‰“ä¸Šæ ‡ç­¾åï¼Œå¯ä»¥ä½¿ç”¨æ ‡ç­¾é€‰æ‹©å™¨è¿‡æ»¤æŒ‡å®šçš„æ ‡ç­¾
  - æ ‡ç­¾é€‰æ‹©å™¨ç›®å‰æœ‰ä¸¤ä¸ªï¼šåŸºäºç­‰å€¼å…³ç³»ï¼ˆç­‰äºã€ä¸ç­‰äºï¼‰å’ŒåŸºäºé›†åˆå…³ç³»ï¼ˆå±äºã€ä¸å±äºã€å­˜åœ¨ï¼‰
  - è®¸å¤šèµ„æºæ”¯æŒå†…åµŒæ ‡ç­¾é€‰æ‹©å™¨å­—æ®µ
    - matchLabels
    - matchExpressions
- Service
  - åœ¨K8Sçš„ä¸–ç•Œé‡Œï¼Œè™½ç„¶æ¯ä¸ªPodéƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªå•ç‹¬çš„IPåœ°å€ï¼Œä½†è¿™ä¸ªIPåœ°å€ä¼šéšç€Podçš„é”€æ¯è€Œæ¶ˆå¤±
  - Serviceï¼ˆæœåŠ¡ï¼‰å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæ¦‚å¿µ
  - ä¸€ä¸ªServiceå¯ä»¥çœ‹ä½œä¸€ç»„æä¾›ç›¸åŒæœåŠ¡çš„Podçš„å¯¹å¤–è®¿é—®æ¥å£
  - Serviceä½œç”¨ä¸å“ªäº›Podæ˜¯é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨æ¥å®šä¹‰çš„
- Ingress
  - Ingressæ˜¯K8Sé›†ç¾¤é‡Œå·¥ä½œåœ¨OSIç½‘ç»œå‚è€ƒæ¨¡å‹ä¸‹ï¼Œç¬¬7å±‚çš„åº”ç”¨ï¼Œå¯¹å¤–æš´éœ²çš„æ¥å£
  - Serviceåªèƒ½è¿›è¡ŒL4æµé‡è°ƒåº¦ï¼Œè¡¨ç°å½¢å¼æ˜¯ip+port
  - Ingressåˆ™å¯ä»¥è°ƒåº¦ä¸åŒä¸šåŠ¡åŸŸã€ä¸åŒURLè®¿é—®è·¯å¾„çš„ä¸šåŠ¡æµé‡

ç®€å•ç†è§£ï¼šPodå¯è¿è¡Œçš„åŸå­ï¼Œnameå®šä¹‰åå­—ï¼Œnamespaceåç§°ç©ºé—´ï¼ˆæ”¾ä¸€å †åå­—ï¼‰ï¼Œlabelæ ‡ç­¾ï¼ˆå¦å¤–çš„åå­—ï¼‰ï¼Œserviceæä¾›æœåŠ¡ï¼Œingressé€šä¿¡

### K8Sæ¶æ„å›¾ï¼ˆå¹¶éä¼ ç»Ÿæ„ä¹‰ä¸Šçš„PaaSæœåŠ¡ï¼Œè€Œæ˜¯IaaSæœåŠ¡ï¼‰

![1582188308711](assets/1582188308711.png)

> **kubectl**ï¼šKubernetesé›†ç¾¤çš„å‘½ä»¤è¡Œæ¥å£
>
> **API Server**ï¼šçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å¯¹æ ¸å¿ƒå¯¹è±¡ï¼ˆä¾‹å¦‚ï¼šPodï¼ŒServiceï¼ŒRCï¼‰çš„å¢åˆ æ”¹æŸ¥æ“ä½œï¼ŒåŒæ—¶ä¹Ÿæ˜¯é›†ç¾¤å†…æ¨¡å—ä¹‹é—´æ•°æ®äº¤æ¢çš„æ¢çº½
>
> **Etcd**ï¼šåŒ…å«åœ¨ APIServer ä¸­ï¼Œç”¨æ¥å­˜å‚¨èµ„æºä¿¡æ¯
>
> **Controller Manager **ï¼šè´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰
>
> **Scheduler**ï¼šè´Ÿè´£èµ„æºçš„è°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„æœºå™¨ä¸Šã€‚å¯ä»¥é€šè¿‡è¿™äº›æœ‰æ›´æ·±çš„äº†è§£ï¼š
>
> - <a href="https://github.com/ben1234560/k8s_PaaS/blob/master/%E5%8E%9F%E7%90%86%E5%8F%8A%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/Kubernetes%E8%B0%83%E5%BA%A6%E6%9C%BA%E5%88%B6.md">Kubernetesè°ƒåº¦æœºåˆ¶</a>
> - <a href="https://github.com/ben1234560/k8s_PaaS/blob/master/%E5%8E%9F%E7%90%86%E5%8F%8A%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/Kubernetes%E8%B0%83%E5%BA%A6%E6%9C%BA%E5%88%B6.md#kubernetes%E7%9A%84%E8%B5%84%E6%BA%90%E6%A8%A1%E5%9E%8B%E4%B8%8E%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86">Kubernetesçš„èµ„æºæ¨¡å‹ä¸èµ„æºç®¡ç†</a>
> - <a href="https://github.com/ben1234560/k8s_PaaS/blob/master/%E5%8E%9F%E7%90%86%E5%8F%8A%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/Kubernetes%E8%B0%83%E5%BA%A6%E6%9C%BA%E5%88%B6.md#kubernetes%E9%BB%98%E8%AE%A4%E7%9A%84%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5">Kubernetesé»˜è®¤çš„è°ƒåº¦ç­–ç•¥</a>
> - <a href="https://github.com/ben1234560/k8s_PaaS/blob/master/%E5%8E%9F%E7%90%86%E5%8F%8A%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/Kubernetes%E8%B0%83%E5%BA%A6%E6%9C%BA%E5%88%B6.md#%E8%B0%83%E5%BA%A6%E5%99%A8%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7%E4%B8%8E%E5%BC%BA%E5%88%B6%E6%9C%BA%E5%88%B6">è°ƒåº¦å™¨çš„ä¼˜å…ˆçº§ä¸å¼ºåˆ¶æœºåˆ¶</a>
>
> **kube-proxy**ï¼šè´Ÿè´£ä¸ºServiceæä¾›clusterå†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡
>
> **Kubelet**ï¼šåœ¨Kubernetesä¸­ï¼Œåº”ç”¨å®¹å™¨å½¼æ­¤æ˜¯éš”ç¦»çš„ï¼Œå¹¶ä¸”ä¸è¿è¡Œå…¶çš„ä¸»æœºä¹Ÿæ˜¯éš”ç¦»çš„ï¼Œè¿™æ˜¯å¯¹åº”ç”¨è¿›è¡Œç‹¬ç«‹è§£è€¦ç®¡ç†çš„å…³é”®ç‚¹ã€‚[Kubeletå·¥ä½œåŸç†è§£æ](https://github.com/ben1234560/k8s_PaaS/blob/master/%E5%8E%9F%E7%90%86%E5%8F%8A%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/Kubernetes%E8%B0%83%E5%BA%A6%E6%9C%BA%E5%88%B6.md#kubelet)
>
> **Node**ï¼šè¿è¡Œå®¹å™¨åº”ç”¨ï¼Œç”±Masterç®¡ç†

### æˆ‘ä»¬éƒ¨ç½²çš„K8Sæ¶æ„å›¾

![1584700891603](assets/1584700891603.png)

> å¯ä»¥ç®€å•ç†è§£æˆï¼š
>
> 11æœºå™¨ï¼šåå‘ä»£ç†
>
> 12æœºå™¨ï¼šåå‘ä»£ç†
>
> 21æœºå™¨ï¼šä¸»æ§+è¿ç®—èŠ‚ç‚¹ï¼ˆå³æœåŠ¡ç¾¤éƒ½æ˜¯è·‘åœ¨21å’Œ22ä¸Šï¼‰
>
> 22æœºå™¨ï¼šä¸»æ§+è¿ç®—èŠ‚ç‚¹ï¼ˆç”Ÿäº§ä¸Šæˆ‘ä»¬ä¼šæŠŠä¸»æ§å’Œè¿ç®—åˆ†å¼€ï¼‰
>
> 200æœºå™¨ï¼šè¿ç»´ä¸»æœºï¼ˆæ”¾å„ç§æ–‡ä»¶èµ„æºï¼‰
>
> è¿™æ ·æ§èŠ‚ç‚¹æœ‰ä¸¤ä¸ªï¼Œè¿ç®—èŠ‚ç‚¹æœ‰ä¸¤ä¸ªï¼Œå°±æ˜¯å°å‹çš„åˆ†å¸ƒå¼ï¼Œç°åœ¨ä½ å¯èƒ½æ²¡åŠæ³•ç†è§£è¿™äº›å†…å®¹ï¼Œæˆ‘ä»¬æ¥ç€åšä¸‹å»ï¼Œæ…¢æ…¢çš„ï¼Œä½ å°±ç†è§£äº†
>
> è¿™æ˜¯ç†è®ºä¸Šçš„æ¶æ„ï¼Œè€ƒè™‘åˆ°å…¬æœ‰äº‘å¯¹ç½‘ç»œçš„é™åˆ¶ç­‰é—®é¢˜ï¼ˆå¦‚ipv6ä¸èƒ½éšæ„å¢åŠ ï¼‰ï¼Œ21ã€22æœºå™¨ä¹Ÿä¼šè¿½åŠ åå‘ä»£ç†ã€‚

### å®éªŒæœºå™¨å®‰è£…è¯¦è§£

æˆ‘ä»¬å°†ç”³è¯·5ä¸ªèŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾

|      | æ•´ä½“  | 11æœºå™¨ | 12æœºå™¨ | 21æœºå™¨ | 22æœºå™¨ | 200æœºå™¨ |
| ---- | ----- | ------ | ------ | ------ | ------ | ------- |
| ä½é… | 4C32G | 2C2G   | 2C2G   | 2C8G   | 2C8G   | 2C2G    |
| æ ‡é… | 8C64G | 2C4G   | 2C4G   | 2C16G  | 2C16G  | 2C2G    |

> ä½é…èƒ½å¤Ÿæ»¡è¶³Jenkinsä¹‹å‰çš„å†…å®¹ï¼Œåšåˆ°Jenkinsçš„æ—¶å€™å°±å·²ç»å¾ˆå¡äº†ï¼Œåˆ°æ—¶å€™å†è¿½åŠ è´­ä¹°æ–°çš„é…ç½®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥è´­ä¹°æ ‡é…ï¼Œå‰æœŸæˆ‘è¿˜æ˜¯å¸Œæœ›å„ä½èƒ½åœ¨ç†è§£ä¸ŠèŠ±äº›æ—¶é—´ï¼Œæ…¢æ…¢çš„æ“ä½œï¼Œå¦åˆ™æŠ¥é”™éƒ½ä¸çŸ¥é“æ€ä¹ˆè§£å†³

### å¦‚ä½•è´­ä¹°å…¬æœ‰äº‘æœºå™¨ï¼ˆä»¥é˜¿é‡Œäº‘ä¸ºä¾‹ï¼‰

> æ³¨ï¼šæœªé€‰çš„åˆ™æ˜¯é»˜è®¤é€‰é¡¹ã€‚

å¦‚ä¸‹å›¾ï¼Œé€‰æ‹©â€œè‡ªå®šä¹‰è´­ä¹°â€ã€â€œæŠ¢å å¼å®ä¾‹â€ï¼ˆè¿™é‡Œä½¿ç”¨æŠ¢å å¼å³å¯/çœé’±ï¼Œæ‹…å¿ƒè¢«å›æ”¶çš„å¯ä»¥é€‰æ‹©æŒ‰é‡ä»˜è´¹ï¼‰ã€â€œæ–°åŠ å¡â€æˆ–å…¶å®ƒå¤–ç½‘æœåŠ¡å™¨åœ°åŸŸï¼ˆå¤–ç½‘æœåŠ¡å™¨ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ç½‘ç«™ç­‰æ—¶ä¸éœ€è¦å¤‡æ¡ˆ/æœ€å¥½å‡†å¤‡ä¸ªæ¢¯å­ï¼Œä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜æ¢¯å­æ˜¯å¿…å¤‡çš„ï¼‰ã€â€œå¯ç”¨åŒºâ€ï¼ˆå¿…é¡»é€‰æ‹©å…¶ä¸­ä¸€ä¸ªå¦‚æˆ‘é€‰çš„å¯ç”¨åŒºBï¼Œä¸èƒ½éšæœºåˆ†é…ï¼Œå¦åˆ™å¤šå°æœºå™¨çš„å†…ç½‘ipä¸ä¸€è‡´ï¼‰

![image-20230510093039761](assets/WX20230511-144757@2x.png)

> **WHYï¼š**ä¸ºä»€ä¹ˆé€‰æ–°åŠ å¡ï¼Œå› ä¸ºæˆ‘çš„æ¢¯å­å¯ä»¥åˆ°æ–°åŠ å¡

é€‰æ‹©â€œå…±äº«å‹â€ï¼ˆä¹Ÿå¯ä»¥é€‰æ‹©é€šç”¨å‹ï¼Œå…±äº«å‹ä¼šæ›´ä¾¿å®œï¼‰ã€é€‰æ‹©2æ ¸8Gå†…å­˜çš„é…ç½®ï¼Œ

![image-20230510100214922](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510100214922.png)

é€‰æ‹©CentOSï¼Œ7.6ç‰ˆæœ¬

![image-20230510100559866](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510100559866.png)

ç½‘ç»œåˆ†é…å…¬ç½‘IPv4åœ°å€ï¼Œé»˜è®¤é€‰æ‹©ï¼Œå…¶å®ƒä¸å˜ï¼Œè¿™æ ·åˆ›å»ºä¸‹æ¥çš„æœåŠ¡å™¨æ˜¯å…¬ç”¨åŒä¸€å®‰å…¨ç»„é…ç½®

é€‰æ‹©â€œè‡ªå®šä¹‰å¯†ç â€œï¼Œå»ºè®®è®¾ç½®ç›¸å¯¹å¤æ‚çš„å¯†ç ï¼Œå¦‚åŒ…å«å¤§å°å†™ï¼Œå¦åˆ™å®¹æ˜“è¢«æ”»ç ´ä½¿ç”¨

![image-20230510100759504](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510100759504.png)

æœ€ç»ˆè®¢å•å†…å®¹

![image-20230510100913556](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510100913556.png)

è´­ä¹°å®Œæˆåçš„å†…å®¹ï¼Œå»ºè®®ç»™æ¯ä¸ªå®ä¾‹è®¾ç½®èŠ‚ç‚¹å«ä¹‰ï¼Œå¦‚ä¸‹å›¾çš„k8s_11ã€k8s_12

![image-20230510101304296](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510101304296.png)

å¦‚ä¸‹æ˜¯æˆ‘çš„å†…ç½‘åŠèŠ‚ç‚¹å¯¹åº”æƒ…å†µ

> |        | 11æœºå™¨         | 12æœºå™¨         | 21æœºå™¨         | 22æœºå™¨         | 200æœºå™¨        |
> | ------ | -------------- | -------------- | -------------- | -------------- | -------------- |
> | å†…ç½‘ip | 172.29.238.166 | 172.29.238.164 | 172.29.238.165 | 172.29.238.163 | 172.29.238.162 |
>
> å¯ä»¥çœ‹åˆ°ç½‘æ®µåœ¨172.29.238.0/254ï¼Œæˆ‘çš„11æœºå™¨å†…ç½‘ipæ˜¯172.29.238.166ï¼Œåç»­å°†ä¼šæŒç»­ç”¨åˆ°ï¼Œä½ éœ€è¦å¡«æˆä½ è‡ªå·±çš„11æœºå™¨å†…ç½‘ip

### æœºå™¨å‰æœŸå‡†å¤‡

ä½¿ç”¨xshellæˆ–è€…è‡ªé€‰çš„shellè¿æ¥å·¥å…·ï¼Œ[xshellä¸‹è½½](https://xshell.en.softonic.com/download)

> å½“ç„¶æˆ‘ä¹Ÿæœ‰æä¾›è½¯ä»¶åŒ…ï¼šhttps://pan.baidu.com/s/1mkIzua1XQmew240XBbvuFA æå–ç ï¼š7p6h ã€‚é‡Œé¢è¿˜æœ‰Xftpï¼Œæ˜¯ç”¨æ¥è¿›è¡Œæœ¬åœ°ç”µè„‘å’Œè™šæ‹Ÿæœºçš„æ–‡ä»¶ä¼ è¾“

~~~
# å…¨éƒ¨æœºå™¨ï¼Œè®¾ç½®åå­—ï¼Œ11æ˜¯hdss7-11,12æ˜¯hdss7-12,ä»¥æ­¤ç±»æ¨
~]# hostnamectl set-hostname hdss7-11.host.com
~]# exit
# ä¸‹é¢çš„ä¿®æ”¹ï¼Œ11æœºå™¨å¯¹åº”11æœºå™¨çš„å†…ç½‘ipï¼Œ12å¯¹åº”12æœºå™¨çš„å†…ç½‘ipï¼Œä»¥æ­¤ç±»æ¨å…±ä¸¤å¤„ï¼šIPADDRã€GATEWAY
~]# vi /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE=eth0
BOOTPROTO=dhcp
ONBOOT=yes
IPADDR=172.29.238.166
GATEWAY=172.29.238.254
NETMASK=255.255.255.0
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=eth0
DEVICE=eth0
IPV6_PEERNDS=yes
IPV6_PEERROUTES=yes
IPV6_PRIUACY=no

~]# systemctl restart network
~]# ping baidu.com
~~~

> **ifcfg-eth0**ï¼šæœ‰äº›äººçš„æœºå™¨å¯èƒ½æ˜¯ifcfg-esn33ã€‚ä½¿ç”¨ifconfigæŸ¥çœ‹ï¼Œå‘½ä»¤è¾“å‡ºä¸­æ¯ä¸ªç½‘å¡æ¥å£éƒ½æœ‰ä¸€ä¸ªåç§°ï¼Œä¾‹å¦‚ "eth0"ã€"ens33" ç­‰
>
> **systemctl restart**ï¼šé‡å¯æŸä¸ªæœåŠ¡
>
> **ping**ï¼šç”¨äºæµ‹è¯•ç½‘ç»œè¿æ¥é‡çš„ç¨‹åº
>
> å…¬æœ‰äº‘ï¼ˆé˜¿é‡Œï¼‰çš„ifcfg-eth0åŸå†…å®¹å¦‚ä¸‹ï¼š
>
> DEVICE=eth0
> BOOTPROTO=dhcp
> ONBOOT=yes

![image-20230510102500398](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510102500398.png)



~~~
# æŸ¥çœ‹enforceæ˜¯å¦å…³é—­ï¼Œç¡®ä¿disabledçŠ¶æ€ï¼Œå½“ç„¶å¯èƒ½æ²¡æœ‰è¿™ä¸ªå‘½ä»¤
~]# getforce
# æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ï¼Œç¡®ä¿åœ¨3.8ä»¥ä¸Šç‰ˆæœ¬
~]# uname -a
# å…³é—­firewalld
~]# systemctl stop firewalld
# å®‰è£…epelæºåŠç›¸å…³å·¥å…·
~]# yum install epel-release -y
~]# yum install wget net-tools telnet tree nmap sysstat lrzsz dos2unix bind-utils -y
~~~

> **uname**:æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯
>
> - **-a/-all**ï¼šæ˜¾ç¤ºå…¨éƒ¨
>
> **yum**ï¼šæä¾›äº†æŸ¥æ‰¾ã€å®‰è£…ã€åˆ é™¤æŸä¸€ä¸ªã€ä¸€ç»„ç”šè‡³å…¨éƒ¨è½¯ä»¶åŒ…çš„å‘½ä»¤
>
> - **install**ï¼šå®‰è£…
> - **-y**ï¼šå½“å®‰è£…è¿‡ç¨‹æç¤ºé€‰æ‹©å…¨éƒ¨ä¸º"yes"

![image-20230510104702344](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510104702344.png)



### K8Så‰ç½®å‡†å¤‡å·¥ä½œâ€”â€”bind9å®‰è£…éƒ¨ç½²ï¼ˆDNSæœåŠ¡ï¼‰

> **WHAT**ï¼šDNSï¼ˆåŸŸåç³»ç»Ÿï¼‰è¯´ç™½äº†ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªåŸŸå’ŒIPåœ°å€åšäº†ä¸€ä¸‹ç»‘å®šï¼Œå¦‚ä½ åœ¨é‡Œæœºå™¨é‡Œé¢è¾“å…¥ nslookup www.qq.comï¼Œå‡ºæ¥çš„Addressæ˜¯ä¸€å †IPï¼ŒIPæ˜¯ä¸å®¹æ˜“è®°çš„ï¼Œæ‰€ä»¥DNSè®©IPå’ŒåŸŸååšä¸€ä¸‹ç»‘å®šï¼Œè¿™æ ·ä½ è¾“å…¥åŸŸåå°±å¯ä»¥äº†
>
> **WHY**ï¼šæˆ‘ä»¬è¦ç”¨ingressï¼Œåœ¨K8Sé‡Œè¦åš7å±‚è°ƒåº¦ï¼Œè€Œä¸”æ— è®ºå¦‚ä½•éƒ½è¦ç”¨åŸŸåï¼ˆå¦‚ä¹‹å‰çš„é‚£ä¸ªç™¾åº¦é¡µé¢çš„åŸŸåï¼Œé‚£ä¸ªæ˜¯hostçš„æ–¹å¼ï¼‰ï¼Œä½†æ˜¯é—®é¢˜æ˜¯æˆ‘ä»¬æ€ä¹ˆç»™K8Sé‡Œçš„å®¹å™¨ç»‘hostï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»åšä¸€ä¸ªDNSï¼Œç„¶åå®¹å™¨æœä»æˆ‘ä»¬çš„DNSè§£æè°ƒåº¦

~~~
# åœ¨11æœºå™¨ï¼š
~]# yum install bind -y
~]# rpm -qa bind
# out: bind-9.11.4-9.P2.el7.x86_64
# é…ç½®ä¸»é…ç½®æ–‡ä»¶ï¼Œ11æœºå™¨
~]# vi /etc/named.conf
listen-on port 53 { 172.29.238.166; };  # åŸæœ¬æ˜¯127.0.0.1ï¼Œæˆ‘çš„11å†…ç½‘ipæ˜¯172.29.238.166ï¼Œä½ å¡«ä½ çš„11å†…ç½‘ip
# listen-on-v6 port 53 { ::1; };  # éœ€è¦åˆ æ‰
allow-query     { any; };  # åŸæœ¬æ˜¯locall
forwarders      { 172.29.238.254; };  #å¦å¤–æ·»åŠ çš„
dnssec-enable no;  # åŸæœ¬æ˜¯yes
dnssec-validation no;  # åŸæœ¬æ˜¯yes

# æ£€æŸ¥ä¿®æ”¹æƒ…å†µï¼Œæ²¡æœ‰æŠ¥é”™å³å¯ï¼ˆå³æ²¡æœ‰ä¿¡æ¯ï¼‰
~]# named-checkconf
~~~

> **rpm**ï¼šè½¯ä»¶åŒ…ç®¡ç†å™¨
>
> - **-qa**ï¼šæŸ¥çœ‹å·²å®‰è£…çš„æ‰€æœ‰è½¯ä»¶åŒ…
>
> **rpmå’Œyumå®‰è£…çš„åŒºåˆ«**ï¼šå‰è€…ä¸æ£€æŸ¥ç›¸ä¾æ€§é—®é¢˜ï¼Œåè€…æ£€æŸ¥ï¼ˆå³ç›¸å…³ä¾èµ–åŒ…ï¼‰
>
> **named.confæ–‡ä»¶å†…å®¹è§£æï¼š**
>
> - **listen-on**ï¼šç›‘å¬ç«¯å£ï¼Œæ”¹ä¸ºç›‘å¬åœ¨å†…ç½‘ï¼Œè¿™æ ·å…¶å®ƒæœºå™¨ä¹Ÿå¯ä»¥ç”¨
> - **allow-query**ï¼šå“ªäº›å®¢æˆ·ç«¯èƒ½é€šè¿‡è‡ªå»ºçš„DNSæŸ¥
> - **forwarders**ï¼šä¸Šçº§DNSæ˜¯ä»€ä¹ˆ

![image-20230510105344849](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510105344849.png)

~~~
# 11æœºå™¨ï¼Œç»éªŒï¼šä¸»æœºåŸŸä¸€å®šå¾—è·Ÿä¸šåŠ¡æ˜¯ä¸€ç‚¹å…³ç³»éƒ½æ²¡æœ‰ï¼Œå¦‚host.comï¼Œè€Œä¸šåŠ¡ç”¨çš„æ˜¯od.comï¼Œå› ä¸ºä¸šåŠ¡éšæ—¶å¯èƒ½å˜
# åŒºåŸŸé…ç½®æ–‡ä»¶ï¼ŒåŠ åœ¨æœ€ä¸‹é¢ï¼Œéœ€è¦ä¿®æ”¹ä¸¤å¤„ï¼šallow-update
~]# vi /etc/named.rfc1912.zones
zone "host.com" IN {
        type  master;
        file  "host.com.zone";
        allow-update { 172.29.238.166; };
};

zone "od.com" IN {
        type  master;
        file  "od.com.zone";
        allow-update { 172.29.238.166; };
};

~~~

<img src="/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510105858429.png" alt="image-20230510105858429" style="zoom: 50%;" />

> **æ³¨æ„ï¼š**å½“é…ç½®11æœºå™¨å†…ç½‘ipåï¼Œè¯¥æœºå™¨åº”ä¿å­˜è¿è¡ŒçŠ¶æ€ï¼Œé‡å¯åå…¶å®ƒæœºå™¨å¯èƒ½æ— æ³•è¿æ¥å¤–ç½‘ã€‚@https://github.com/xinzhuxianshengæ„Ÿè°¢å»ºè®®ï¼

~~~
# 11æœºå™¨ï¼š
# æ³¨æ„serialè¡Œçš„æ—¶é—´ï¼Œä»£è¡¨ä»Šå¤©çš„æ—¶é—´+ç¬¬ä¸€æ¡è®°å½•ï¼š20230510+01ï¼Œéœ€è¦ä¿®æ”¹serialã€å„ä¸ªipã€
7-11 ~]# vi /var/named/host.com.zone
$ORIGIN host.com.
$TTL 600	; 10 minutes
@       IN SOA	dns.host.com. dnsadmin.host.com. (
				2023051001 ; serial
				10800      ; refresh (3 hours)
				900        ; retry (15 minutes)
				604800     ; expire (1 week)
				86400      ; minimum (1 day)
				)
			NS   dns.host.com.
$TTL 60	; 1 minute
dns                A    172.29.238.166
HDSS7-11           A    172.29.238.166
HDSS7-12           A    172.29.238.164
HDSS7-21           A    172.29.238.165
HDSS7-22           A    172.29.238.163
HDSS7-200          A    172.29.238.162

7-11 ~]# vi /var/named/od.com.zone
$ORIGIN od.com.
$TTL 600	; 10 minutes
@   		IN SOA	dns.od.com. dnsadmin.od.com. (
				2023051001 ; serial
				10800      ; refresh (3 hours)
				900        ; retry (15 minutes)
				604800     ; expire (1 week)
				86400      ; minimum (1 day)
				)
				NS   dns.od.com.
$TTL 60	; 1 minute
dns                A    172.29.238.166

# çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰æŠ¥é”™
7-11 ~]# named-checkconf
7-11 ~]# systemctl start named
7-11 ~]# netstat -luntp|grep 53
~~~

> **TTL 600**ï¼šæŒ‡å®šIPåŒ…è¢«è·¯ç”±å™¨ä¸¢å¼ƒä¹‹å‰å…è®¸é€šè¿‡çš„æœ€å¤§ç½‘æ®µæ•°é‡
>
> - **10 minutes**ï¼šè¿‡æœŸæ—¶é—´10åˆ†é’Ÿ
>
> **SOA**ï¼šä¸€ä¸ªåŸŸæƒå¨è®°å½•çš„ç›¸å…³ä¿¡æ¯ï¼Œåé¢æœ‰5ç»„å‚æ•°åˆ†åˆ«è®¾å®šäº†è¯¥åŸŸç›¸å…³éƒ¨åˆ†
>
> - **dnsadmin.od.com.**  ä¸€ä¸ªå‡çš„é‚®ç®±
> - **serial**ï¼šè®°å½•çš„æ—¶é—´
>
> **$ORIGIN**ï¼šå³ä¸‹åˆ—çš„åŸŸåè‡ªåŠ¨è¡¥å……od.comï¼Œå¦‚dnsï¼Œå¤–é¢çœ‹æ¥æ˜¯dns.od.com
>
> **netstat -luntp**ï¼šæ˜¾ç¤º tcp,udp çš„ç«¯å£å’Œè¿›ç¨‹ç­‰ç›¸å…³æƒ…å†µ

![image-20230510110314995](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510110314995.png)

~~~
# 11æœºå™¨ï¼Œæ£€æŸ¥ä¸»æœºåŸŸæ˜¯å¦è§£æ
7-11 ~]# dig -t A hdss7-21.host.com @172.29.238.166 +short
# é…ç½®æœåŠ¡å™¨èƒ½ä½¿ç”¨è¿™ä¸ªé…ç½®ï¼Œåœ¨æœ€ä¸‹é¢è¿½åŠ 11æœºå™¨çš„å†…ç½‘ip
7-11 ~]# vi /etc/sysconfig/network-scripts/ifcfg-eth0
DNS1=172.29.238.166
7-11 ~]# systemctl restart network
# é‡å¯ç½‘ç»œåï¼Œé©¬ä¸Špingå¯èƒ½æ— æ³•è¿æ¥ï¼Œéœ€è¦ç­‰ä¸ªåç§’é’Ÿ
7-11 ~]# ping www.baidu.com
7-11 ~]# ping hdss7-21.host.com
~~~

> **dig -t A**ï¼šæŒ‡çš„æ˜¯æ‰¾DNSé‡Œæ ‡è®°ä¸ºAçš„ç›¸å…³è®°å½•ï¼Œè€Œåé¢ä¼šå¸¦ä¸Šç›¸å…³çš„åŸŸï¼Œå¦‚ä¸Šé¢çš„hdss7-21.host.comï¼Œä¸ºä»€ä¹ˆå¤–é¢é…äº†HDSS7-21åé¢è¿˜ä¼šè‡ªåŠ¨æ¥ä¸Š.host.comå°±æ˜¯å› ä¸º$ORIGINï¼Œåé¢åˆ™æ˜¯å¯¹åº”çš„IP
>
> - **+short**ï¼šè¡¨ç¤ºåªè¿”å›IP

![image-20230510110840167](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510110840167.png)

~~~
# åœ¨é11æœºå™¨ä¸Šï¼Œæœ€ä¸‹é¢è¿½åŠ dns1=11æœºå™¨å†…ç½‘ip
~]# vi /etc/sysconfig/network-scripts/ifcfg-eth0
DNS1=172.29.238.166

~]# systemctl restart network
# è¯•ä¸‹ç½‘ç»œæ˜¯å¦æ­£å¸¸
~]# ping baidu.com
# å…¶å®ƒæœºå™¨å°è¯•ping7-11æœºå™¨æˆ–200æœºå™¨ç­‰ä»»æ„æœºå™¨ï¼Œè¿™æ—¶å€™çŸ­åŸŸåæ˜¯å¯ä»¥ä½¿ç”¨äº†
7-12 ~]# ping hdss7-11.host.com
7-12 ~]# ping hdss7-200.host.com
~~~

> è®©å…¶å®ƒæœºå™¨çš„DNSå…¨éƒ¨æ”¹æˆ11æœºå™¨çš„å¥½å¤„æ˜¯ï¼Œå…¨éƒ¨çš„æœºå™¨è®¿é—®å¤–ç½‘å°±åªæœ‰é€šè¿‡11ç«¯å£ï¼Œæ›´å¥½æ§åˆ¶

æœºå™¨å‡†å¤‡å·¥ä½œå®Œæˆ:tada:



### K8Så‰ç½®å·¥ä½œâ€”â€”å‡†å¤‡ç­¾å‘è¯ä¹¦ç¯å¢ƒ

> **WHAT**ï¼š è¯ä¹¦ï¼Œå¯ä»¥ç”¨æ¥å®¡è®¡ä¹Ÿå¯ä»¥ä¿éšœå®‰å…¨ï¼Œk8Sç»„ä»¶å¯åŠ¨çš„æ—¶å€™ï¼Œåˆ™éœ€è¦æœ‰å¯¹åº”çš„è¯ä¹¦ï¼Œè¯ä¹¦çš„è¯¦è§£ä½ ä¹Ÿå¯ä»¥åœ¨ç½‘ä¸Šæœåˆ°ï¼Œè¿™é‡Œå°±ä¸ç»†ç»†è¯´æ˜äº†
>
> **WHY**ï¼šå½“ç„¶æ˜¯ä¸ºäº†è®©æˆ‘ä»¬çš„ç»„ä»¶èƒ½æ­£å¸¸è¿è¡Œ

~~~
# cfsslæ–¹å¼åšè¯ä¹¦ï¼Œéœ€è¦ä¸‰ä¸ªè½¯ä»¶ï¼ˆå¦‚æœç½‘ç»œæ— æ³•è¿é€šï¼Œåˆ™å‚è€ƒä¸‹é¢æˆ‘å·²ä¸‹è½½å¥½çš„è½¯ä»¶åŒ…ï¼‰ï¼ŒæŒ‰ç…§æˆ‘ä»¬çš„æ¶æ„å›¾ï¼Œæˆ‘ä»¬éƒ¨ç½²åœ¨200æœºå™¨:
200 ~]# wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64 -O /usr/bin/cfssl
200 ~]# wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64 -O /usr/bin/cfssl-json
200 ~]# wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64 -O /usr/bin/cfssl-certinfo
200 ~]# chmod +x /usr/bin/cfssl*
200 ~]# which cfssl
200 ~]# which cfssl-json
200 ~]# which cfssl-certinfo
~~~

> **wget**ï¼šä»ç½‘ç»œä¸Šè‡ªåŠ¨ä¸‹è½½æ–‡ä»¶çš„è‡ªç”±å·¥å…·
>
> **chmod**ï¼šç»™å¯¹åº”çš„æ–‡ä»¶æ·»åŠ æƒé™ï¼ˆ[èœé¸Ÿæ•™ç¨‹](https://www.runoob.com/linux/linux-comm-chmod.html)ï¼‰
>
> - **+x**ï¼šç»™å½“å‰ç”¨æˆ·å¢åŠ å¯æ‰§è¡Œè¯¥æ–‡ä»¶çš„æƒé™
>
> **which**ï¼šæŸ¥çœ‹ç›¸åº”çš„ä¸œè¥¿åœ¨å“ªé‡Œ

##### æŠ¥é”™ï¼šwgetæŠ¥é”™ç½‘ç»œé—®é¢˜

~~~
# é’ˆå¯¹ä¸‹è½½cfsslç½‘ç»œæ— æ³•è¿é€šçš„æƒ…å†µï¼Œç™¾åº¦äº‘https://pan.baidu.com/s/1arE2LdtAbcR80gmIQtIELw æå–ç ï¼šouy1ã€‚æ‰¾åˆ°åä¸ºâ€ç¬¬äºŒç« æ¶‰åŠçš„è½¯ä»¶åŒ…â€œä¸­çš„cfsslçš„3ä¸ªæ–‡ä»¶ï¼Œä¸Šä¼ åˆ°/rootç›®å½•ä¸‹
200 ~]# cp cfssl_linux-amd64 /usr/bin/cfssl
200 ~]# cp cfssljson_linux-amd64 /usr/bin/cfssl-json
200 ~]# cp cfssl-certinfo_linux-amd64 /usr/bin/cfssl-certinfo
200 ~]# chmod +x /usr/bin/cfssl*
200 ~]# which cfssl
200 ~]# which cfssl-json
200 ~]# which cfssl-certinfo
~~~

![image-20230510133419709](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510133419709.png)



~~~
200 ~]# mkdir /opt/certs
200 ~]# cd /opt/certs
certs]# vi ca-csr.json
{
    "CN": "ben123123",
    "hosts": [
    ],
    "key": {
        "algo": "rsa",
        "size": 2048
    },
    "names": [
        {
            "C": "CN",
            "ST": "beijing",
            "L": "beijing",
            "O": "od",
            "OU": "ops"
        }
    ],
    "ca": {
        "expiry": "1752000h"
    }
}
certs]# cfssl gencert -initca ca-csr.json | cfssl-json -bare ca
certs]# cat ca.pem
# å¦‚æœä½ è¿™æ—¶å€™æ˜¾ç¤ºæ®µé”™è¯¯æˆ–è€…jsoné”™è¯¯ï¼Œå°±æ˜¯ä¹‹å‰å…‹éš†è™šæ‹Ÿæœºçš„æ—¶å€™200æœºå™¨åœ°å€å’Œåˆ«çš„æœºå™¨åœ°å€é‡å å†²çªäº†ï¼Œéœ€è¦é‡å»º200è™šæ‹Ÿæœº
~~~

> **cd **ï¼šåˆ‡æ¢å½“å‰å·¥ä½œç›®å½•åˆ° dirName
>
> - è¯­æ³•ï¼šcd [dirName]
>
> **mkdir**ï¼šå»ºç«‹åç§°ä¸º dirName ä¹‹å­ç›®å½•
>
> - è¯­æ³•ï¼šmkdir [-p] dirName
> - **-p:** ç¡®ä¿ç›®å½•å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™å»ºä¸€ä¸ªï¼Œå¦‚mkdir empty/empty1/empty2
>
> **cfssl**ï¼šè¯ä¹¦å·¥å…·
>
> - gencertï¼šç”Ÿæˆçš„æ„æ€
>
> **ca-csr.jsonè§£æï¼š**
>
> - CNï¼šCommon Nameï¼Œæµè§ˆå™¨ä½¿ç”¨è¯¥å­—æ®µéªŒè¯ç½‘å€æ˜¯å¦åˆæ³•ï¼Œä¸€èˆ¬å†™åŸŸåï¼Œéå¸¸é‡è¦
> - STï¼šStateï¼Œçœ
> - Lï¼šLocalityï¼Œåœ°åŒº
> - Oï¼šOrganization Nameï¼Œç»„ç»‡åç§°
> - OUï¼šOrganization Unit Nameï¼Œç»„ç»‡å•ä½åç§°
>
> <a href="https://github.com/ben1234560/k8s_PaaS/blob/master/%E5%8E%9F%E7%90%86%E5%8F%8A%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/Kubernetes%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5.md#pod%E4%B8%AD%E5%87%A0%E4%B8%AA%E9%87%8D%E8%A6%81%E5%AD%97%E6%AE%B5%E7%9A%84%E5%90%AB%E4%B9%89%E5%92%8C%E7%94%A8%E6%B3%95">Podä¸­å‡ ä¸ªé‡è¦å­—æ®µçš„å«ä¹‰å’Œç”¨æ³•</a>

![image-20230510133747012](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510133747012.png)



### K8Så‰ç½®å·¥ä½œâ€”â€”éƒ¨ç½²dockerç¯å¢ƒ

> **WHAT**ï¼šæ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„é•œåƒä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„ Linuxæˆ–Windows æœºå™¨ä¸Šï¼Œä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–ã€‚
>
> **WHY**ï¼šPodé‡Œé¢å°±æ˜¯ç”±æ•°ä¸ªdockerå®¹å™¨ç»„æˆï¼ŒPodæ˜¯è±Œè±†èšï¼Œdockerå®¹å™¨æ˜¯é‡Œé¢çš„è±†å­ã€‚

~~~
# å¦‚æˆ‘ä»¬æ¶æ„å›¾æ‰€ç¤ºï¼Œè¿ç®—èŠ‚ç‚¹æ˜¯21/22æœºå™¨ï¼ˆæ²¡æœ‰dockeråˆ™æ— æ³•è¿è¡Œpodï¼‰ï¼Œè¿ç»´ä¸»æœºæ˜¯200æœºå™¨ï¼ˆæ²¡æœ‰dockeråˆ™æ²¡åŠæ³•ä¸‹è½½dockerå­˜å…¥ç§æœ‰ä»“åº“ï¼‰ï¼Œæ‰€ä»¥åœ¨ä¸‰å°æœºå™¨å®‰è£…ï¼ˆ21/22/200ï¼‰
~]# curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun
# ä¸Šé¢çš„ä¸‹è½½å¯èƒ½ç½‘ç»œæœ‰é—®é¢˜ï¼Œéœ€è¦å¤šè¯•å‡ æ¬¡ï¼Œè¿™äº›éƒ¨ç½²æˆ‘å·²ç»ä¸åŒæœºå™¨è¯•è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œå®åœ¨ä¸è¡Œçš„ä½¿ç”¨ä¸‹é¢æä¾›çš„æŠ¥é”™è§£å†³æ–¹æ³•ã€‚
~]# mkdir -p /data/docker /etc/docker
# # æ³¨æ„ï¼Œ172.7.21.1ï¼Œè¿™é‡Œå¾—21æ˜¯æŒ‡åœ¨hdss7-21å¾—æœºå™¨ï¼Œå¦‚æœæ˜¯22å¾—æœºå™¨ï¼Œå°±æ˜¯172.7.22.1ï¼Œå…±ä¸€å¤„éœ€è¦æ”¹æœºå™¨åï¼š"bip": "172.7.21.1/24"
~]# vi /etc/docker/daemon.json
{
  "data-root": "/data/docker",
  "storage-driver": "overlay2",
  "insecure-registries": ["registry.access.redhat.com","quay.io","harbor.od.com"],
  "registry-mirrors": ["https://q2gr04ke.mirror.aliyuncs.com"],
  "bip": "172.7.21.1/24",
  "exec-opts": ["native.cgroupdriver=systemd"],
  "live-restore": true
}

~]# systemctl start docker
~]# docker version
~]# docker ps -a
~~~

> **mkdir -pï¼š**å‰é¢æœ‰è®²åˆ°è¿‡ï¼ˆä¸Šä¸€çº§ç›®å½•æ²¡æœ‰åˆ™åˆ›å»ºï¼‰ï¼Œè€Œè¿™æ¬¡åé¢å¸¦äº†ä¸¤ä¸ªç›®å½•ï¼Œæ„æ€æ˜¯åŒæ—¶åˆ›å»ºä¸¤ä¸ªç›®å½•
>
> **daemon.jsonï¼š**ä¸ºä»€ä¹ˆé…aliyuncsçš„ç¯å¢ƒï¼Œæ˜¯å› ä¸ºé»˜è®¤æ˜¯è¿æ¥åˆ°å¤–ç½‘çš„ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å›½å†…çš„é˜¿é‡Œäº‘é•œåƒæºï¼Œå½“ç„¶è¿˜æœ‰è…¾è®¯äº‘ç­‰
>
> **docker versionï¼š**æŸ¥çœ‹dockerçš„ç‰ˆæœ¬
>
> **daemon.jsonè§£æï¼š**é‡ç‚¹è¯´ä¸€ä¸‹è¿™ä¸ªä¸ºä»€ä¹ˆ10.4.7.21æœºå™¨å¯¹åº”ç€172.7.21.1/24ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°10çš„21å¯¹åº”å¾—æ˜¯172çš„21ï¼Œè¿™æ ·åšçš„å¥½å¤„å°±æ˜¯ï¼Œå½“ä½ çš„podå‡ºç°é—®é¢˜æ—¶ï¼Œä½ å¯ä»¥é©¬ä¸Šå®šä½åˆ°æ˜¯åœ¨å“ªå°æœºå™¨å‡ºç°çš„é—®é¢˜ï¼Œæ˜¯21è¿˜æ˜¯22è¿˜æ˜¯å…¶å®ƒçš„ï¼Œè¿™ç‚¹åœ¨ç”Ÿäº§ä¸Šéå¸¸é‡è¦ï¼Œæœ‰æ—¶å€™ä½ çš„dashboardï¼ˆåé¢ä¼šå®‰è£…ï¼‰å®•æ‰äº†ï¼Œä½ æ²¡åŠæ³•åªèƒ½å»æœºå™¨æ‰¾ï¼Œè€Œè¿™æ—¶å€™ä½ åˆæ‰¾ä¸åˆ°çš„æ—¶å€™ï¼Œä½ è€æ¿ä¼šæ‹¿ä½ ç¥­å¤©çš„

##### æŠ¥é”™ï¼šcurl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun

æŠ¥é”™ä¿¡æ¯ï¼š

http://mirrors.cloud.aliyuncs.com/centos/7/updates/x86_64/Packages/libxml2-2.9.1-6.el7_9.6.x86_64.rpm: [Errno 14] curl#6 - "Could not resolve host: mirrors.cloud.aliyuncs.com; Unknown error"
Trying other mirror.

Error downloading packages:
  libxml2-2.9.1-6.el7_9.6.x86_64: [Errno 256] No more mirrors to try.
  python-kitchen-1.1.1-5.el7.noarch: [Errno 256] No more mirrors to try.
  yum-utils-1.1.31-54.el7_8.noarch: [Errno 256] No more mirrors to try.
  python-chardet-2.2.1-3.el7.noarch: [Errno 256] No more mirrors to try.
  libxml2-python-2.9.1-6.el7_9.6.x86_64: [Errno 256] No more mirrors to try.

åŸå› ï¼šyumæºå‡ºç°é—®é¢˜

è§£å†³æ–¹æ³•ï¼š

~~~
mv /etc/yum.repos.d/epel.repo /etc/yum.repos.d/epel.repo.bak
curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo  # è¿™ä¸€æ­¥å¿…é¡»æˆåŠŸï¼Œæ²¡æˆåŠŸçš„å†æ‰§è¡Œä¸€éå³å¯
yum update -y  # è¿™ä¸€æ­¥è€—æ—¶è¾ƒé•¿
yum install epel-release -y
yum install -y yum-utils
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
yum install -y docker-ce
~~~

![image-20230510141020872](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510141020872.png)



### K8Så‰ç½®å·¥ä½œâ€”â€”éƒ¨ç½²harborä»“åº“

> **WHAT **ï¼šharborä»“åº“æ˜¯å¯ä»¥éƒ¨ç½²åˆ°æœ¬åœ°çš„ç§æœ‰ä»“åº“ï¼Œä¹Ÿå°±æ˜¯ä½ å¯ä»¥æŠŠé•œåƒæ¨åˆ°è¿™ä¸ªä»“åº“ï¼Œç„¶åéœ€è¦ç”¨çš„æ—¶å€™å†ä¸‹è½½ä¸‹æ¥ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ï¼š1ã€ä¸‹è½½é€Ÿåº¦å¿«ï¼Œç”¨åˆ°çš„æ—¶å€™èƒ½é©¬ä¸Šä¸‹è½½ä¸‹æ¥2ã€ä¸ç”¨æ‹…å¿ƒé•œåƒæ”¹åŠ¨æˆ–è€…ä¸‹æ¶ç­‰ã€‚
>
> **WHY**ï¼šå› ä¸ºæˆ‘ä»¬çš„éƒ¨ç½²K8Sæ¶‰åŠåˆ°å¾ˆå¤šé•œåƒï¼Œåˆ¶ä½œç›¸å…³åŒ…çš„æ—¶å€™å¦‚æœç½‘é€Ÿé—®é¢˜ä¼šå¯¼è‡´å¤±è´¥é‡æ¥ï¼Œè€Œä¸”æˆ‘ä»¬åœ¨å…¬å¸é‡Œä¹Ÿä¼šå»ºè‡ªå·±çš„ä»“åº“ï¼Œæ‰€ä»¥å¿…é¡»æŒ‰ç…§harborä»“åº“

~~~
# å¦‚æ¶æ„å›¾ï¼Œæˆ‘ä»¬å®‰è£…åœ¨200æœºå™¨ï¼š
200 ~]# mkdir /opt/src  && cd /opt/src
# å¯ä»¥å»è¿™ä¸ªåœ°å€ä¸‹è½½ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨æˆ‘ç”¨çš„è½¯ä»¶åŒ…
https://github.com/goharbor/harbor/releases/tag/v1.8.3
200 src]# wget https://storage.googleapis.com/harbor-releases/release-1.8.0/harbor-offline-installer-v1.8.3.tgz
# æˆ–è€…ç”¨è¾ƒæ–°çš„åŒ…ï¼ˆæœªæµ‹è¯•åé¢çš„é€‚é…æƒ…å†µï¼‰wget https://github.com/goharbor/harbor/releases/download/v2.8.0/harbor-offline-installer-v2.8.0.tgz
7-200 src]# tar xf harbor-offline-installer-v1.8.3.tgz -C /opt/
~~~

> **tag**ï¼šå¯ä»¥åŠ å…¥ï¼Œè§£å¼€å¤‡ä»½æ–‡ä»¶å†…çš„æ–‡ä»¶
>
> - **x**ï¼šè§£å‹
> - **f**ï¼š ä½¿ç”¨æ¡£æ¡ˆåå­—
> - **-C**ï¼šåˆ‡æ¢åˆ°æŒ‡å®šçš„ç›®å½•
> - æ•´æ¡å‘½ä»¤åˆèµ·æ¥å°±æ˜¯ï¼ŒæŠŠtgzæ–‡ä»¶ä»¥tgzæ–‡ä»¶åä¸ºåå­—è§£å‹åˆ°optç›®å½•ä¸‹ï¼Œå¹¶ä¿å­˜tgzæ–‡ä»¶åŸæ ·
>
> **å…³äºç‰ˆæœ¬**ï¼šä¸€èˆ¬äººéƒ½æ˜¯å–œæ¬¢ç”¨æ¯”è¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å½“ç„¶ä¹Ÿæ”¯æŒæ¯”è¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œä½†å¯¹äºå…¬å¸è€Œå·²ï¼Œç¨³å®šæ˜¯æœ€è¦ç´§çš„ï¼Œv1.8.3æ˜¯ç”¨çš„æ¯”è¾ƒç¨³å®šçš„ç‰ˆæœ¬ï¼Œè€Œåç»­çš„å„ä¸ªç»„ä»¶ä¹Ÿä¼šæœ‰æ›´åŠ æ–°çš„ç‰ˆæœ¬ï¼Œä½ å¯ä»¥å°è¯•æ–°ç‰ˆæœ¬ï¼Œä½†æœ‰äº›ç”±äºå…¼å®¹é—®é¢˜ä¸èƒ½ç”¨æ–°çš„ï¼Œåç»­é‚£äº›ä¸èƒ½ç”¨æˆ‘ä¼šæ ‡è®°æ¸…æ¥šã€‚

~~~
# 200æœºå™¨ï¼š
200 src]# cd /opt/
200 opt]# mv harbor/ harbor-v1.8.3
200 opt]# ln -s /opt/harbor-v1.8.3/ /opt/harbor
200 opt]# cd harbor
200 harbor]# ll
200 harbor]# vi harbor.yml  # å¦‚æœè¿™é‡Œæ˜¯ç”¨çš„2.8.0ç‰ˆæœ¬ï¼Œåˆ™éœ€è¦cp harbor.yml.tmpl harbor.yml
hostname: harbor.od.com  # åŸreg.mydomain.com
http:
  port: 180  # åŸ80
data_volume: /data/harbor
location: /data/harbor/logs

200 harbor]# mkdir -p /data/harbor/logs
200 harbor]# yum install docker-compose -y
200 harbor]# rpm -qa docker-compose
# out: docker-compose-1.18.0-4.el7.noarch
# yum install docker-compose åŒ…æ— æ³•ä¸‹è½½çš„ï¼Œå¯ä»¥æŸ¥çœ‹ä¸‹é¢æä¾›çš„æŠ¥é”™è§£å†³æ–¹æ³•
200 harbor]# ./install.sh
~~~

> **æç¤º**ï¼šharbor v2.3.3ç‰ˆæœ¬å®‰è£…ä¹Ÿéœ€è¦å°†httpsç›¸å…³çš„é…ç½®æ³¨é‡Šæ‰
>
> å¦‚å›¾#https:
>
> ![1635775214057](/Users/xueweiguo/Desktop/GitHub/k8s_PaaS/assets/1635775214057.png)
>
> æ„Ÿè°¢@https://github.com/xinzhuxiansheng
>
> **mv**ï¼šä¸ºæ–‡ä»¶æˆ–ç›®å½•æ”¹åã€æˆ–å°†æ–‡ä»¶æˆ–ç›®å½•ç§»å…¥å…¶å®ƒä½ç½®ã€‚
>
> - è¿™é‡Œçš„å‘½ä»¤æ˜¯æœ‰æ–œæ çš„ï¼Œæ‰€ä»¥æ˜¯ç§»åŠ¨åˆ°æŸä¸ªç›®å½•ä¸‹
>
> **ln**ï¼šä¸ºæŸä¸€ä¸ªæ–‡ä»¶åœ¨å¦å¤–ä¸€ä¸ªä½ç½®å»ºç«‹ä¸€ä¸ªåŒæ­¥çš„é“¾æ¥
>
> - `è¯­æ³•:ln [å‚æ•°][æºæ–‡ä»¶æˆ–ç›®å½•][ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•]`
> - `**-sï¼š**è½¯è¿æ¥ï¼Œå¯ä»¥å¯¹æ•´ä¸ªç›®å½•è¿›è¡Œé“¾æ¥`
>
> **harbor.ymlè§£æï¼š**
>
> - portä¸ºä»€ä¹ˆæ”¹æˆ180ï¼šå› ä¸ºåé¢æˆ‘ä»¬è¦è£…nginxï¼Œnginxç”¨çš„80ï¼Œæ‰€ä»¥è¦æŠŠå®ƒä»¬é”™å¼€
> - data_volumeï¼šæ•°æ®å·ï¼Œå³dockeré•œåƒæ”¾åœ¨å“ªé‡Œ
> - locationï¼šæ—¥å¿—æ–‡ä»¶
> - **./install.sh**ï¼šå¯åŠ¨shellè„šæœ¬

##### æŠ¥é”™ï¼šyum install docker-compose -yæŠ¥é”™No package docker-compose available.

ä½¿ç”¨æˆ‘æä¾›çš„å®˜æ–¹è½¯ä»¶åŒ…ï¼ˆæ”¾åœ¨ç™¾åº¦ç½‘ç›˜ï¼‰ï¼Œæ”¾åˆ°harborè·¯å¾„ä¸‹

~~~
200 harbor]# sudo cp docker-compose-Linux-x86_64 /usr/local/bin/docker-compose
200 harbor]# sudo chmod +x /usr/local/bin/docker-compose
200 harbor]# docker-compose --version
# out: docker-compose version 1.29.2, build 5becea4c
200 harbor]# ./install.sh
~~~

![image-20230510143719007](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510143719007.png)

![image-20230510143950978](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510143950978.png)

> è¿™å¼ å›¾æ˜¯2.8.0ç‰ˆæœ¬çš„ï¼Œ1.8.3ç‰ˆæœ¬æ˜¯æµ‹è¯•è¿‡èƒ½æ­£å¸¸é€‚é…çš„

~~~
# 200æœºå™¨ï¼š
200 harbor]# docker-compose ps
200 harbor]# docker ps -a
200 harbor]# yum install nginx -y  # æŠ¥é”™çš„å‚è€ƒä¸‹é¢æŠ¥é”™å¯¹åº”çš„è§£å†³æ–¹æ³•

###ç›¸å…³æŠ¥é”™é—®é¢˜ï¼š
yumçš„æ—¶å€™æŠ¥ï¼š/var/run/yum.pid å·²è¢«é”å®šï¼ŒPID ä¸º 1610 çš„å¦ä¸€ä¸ªç¨‹åºæ­£åœ¨è¿è¡Œã€‚
å¦å¤–ä¸€ä¸ªç¨‹åºé”å®šäº† yumï¼›ç­‰å¾…å®ƒé€€å‡ºâ€¦â€¦
ç½‘ä¸Šç»Ÿä¸€çš„è§£å†³åŠæ³•ï¼šç›´æ¥åœ¨ç»ˆç«¯è¿è¡Œ rm -f /var/run/yum.pid å°†è¯¥æ–‡ä»¶åˆ é™¤ï¼Œç„¶åå†æ¬¡è¿è¡Œyumã€‚
###
~~~

##### æŠ¥é”™ï¼šyum install nginx -yæ²¡æœ‰å¯¹åº”åŒ…

~~~
200 ~]# yum install nginx -y
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirrors.aliyun.com
 * extras: mirrors.aliyun.com
 * updates: mirrors.aliyun.com
No package nginx available.
Error: Nothing to do
~~~

è§£å†³æ–¹æ³•

~~~
# ç¼–å†™nginx.repo
200 harbor]# sudo vi /etc/yum.repos.d/nginx.repo
[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/centos/7/$basearch/
gpgcheck=0
enabled=1

# ä¿å­˜é€€å‡ºåå³å¯å®‰è£…nginxäº†
200 harbor]# sudo yum install nginx -y
~~~



è§£å†³å®Œæ¥ç€èµ°

~~~
200 harbor]# vi /etc/nginx/conf.d/harbor.od.com.conf
server {
    listen       80;
    server_name  harbor.od.com;

    client_max_body_size 1000m;

    location / {
        proxy_pass http://127.0.0.1:180;
    }
}

200 harbor]# nginx -t
200 harbor]# systemctl start nginx
200 harbor]# systemctl enable nginx
~~~

> **nginx -t**ï¼šæµ‹è¯•*nginx*.confé…ç½®æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨è¯­æ³•é”™è¯¯
>
> **systemctl enable nginx**ï¼šå¼€æœºè‡ªåŠ¨å¯åŠ¨

è¿½åŠ åŸŸåè§£æ

~~~
# åœ¨11æœºå™¨è§£æåŸŸåï¼š
~]# vi /var/named/od.com.zone
# æ³¨æ„serialå‰æ»šä¸€ä¸ªåºå·
# æœ€ä¸‹é¢æ·»åŠ åŸŸå
harbor             A    172.29.238.162
~]# systemctl restart named
~]# dig -t A harbor.od.com +short
# out:172.29.238.162
~~~

![image-20230510171927368](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510171927368.png)

~~~
# 200æœºå™¨ä¸Šcurlï¼š
harbor]# curl harbor.od.com
~~~

> æ³¨æ„ï¼š
>
> getenforceå¾—æ˜¯å…³é—­çŠ¶æ€ï¼Œè€Œä¸æ˜¯enforcingï¼Œå¦åˆ™ä¼šæŠ¥502
> æš‚æ—¶å…³é—­setenforce 0
> æ°¸ä¹…å…³é—­ï¼Œæ”¹é…ç½®æ–‡ä»¶ vi /etc/selinux/config
> SELINUX=disabled

![image-20230510171956492](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230510171956492.png)

å…¬æœ‰äº‘çš„å®‰å…¨ç»„æ·»åŠ tcp 180ç«¯å£æƒé™![image-20230508143611983](/Users/xueweiguo/Library/Application Support/typora-user-images/image-20230508143611983.png)

åœ¨æœ¬æœºï¼ˆwindow/macï¼‰hostsï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ æ–°çš„ DNS åŸŸåè§£æï¼Œå¦‚ï¼š

~~~
å…¬ç½‘ip harbo.od.com  # å…¬ç½‘ipå¯¹åº”200æœºå™¨çš„å…¬ç½‘ip
~~~

[è®¿é—®harbo.od.com](harbor.od.com)

![1578831134362](/Users/xueweiguo/Desktop/GitHub/k8s_PaaS/assets/1578831134362.png)

~~~
è´¦å·ï¼šadmin
å¯†ç ï¼šHarbor12345
æ–°å»ºä¸€ä¸ªpublicå…¬å¼€é¡¹ç›®
~~~

![1578831458247](/Users/xueweiguo/Desktop/GitHub/k8s_PaaS/assets/1578831458247.png)

~~~
# 200æœºå™¨ï¼Œå°è¯•ä¸‹æ˜¯å¦èƒ½pushæˆåŠŸåˆ°harborä»“åº“
harbor]# docker pull nginx:1.7.9
harbor]# docker images|grep 1.7.9
harbor]# docker tag 84581e99d807 harbor.od.com/public/nginx:v1.7.9
harbor]# docker login harbor.od.com
è´¦å·ï¼šadmin
å¯†ç ï¼šHarbor12345
harbor]# docker push harbor.od.com/public/nginx:v1.7.9
# æŠ¥é”™ï¼šå¦‚æœå‘ç°ç™»å½•ä¸ä¸Šå»äº†ï¼Œè¿‡ä¸€é˜µå­å†ç™»å½•å³å¯ï¼Œå¤§çº¦5åˆ†é’Ÿå·¦å³
~~~

![1578832524891](/Users/xueweiguo/Desktop/GitHub/k8s_PaaS/assets/1578832524891.png)

æˆåŠŸï¼Œæ­¤æ—¶ä½ å·²æˆåŠŸå»ºç«‹äº†è‡ªå·±çš„æœ¬åœ°ç§æœ‰ä»“åº“

